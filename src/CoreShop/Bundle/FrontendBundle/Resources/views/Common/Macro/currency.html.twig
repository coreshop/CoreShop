{%- macro format(amount, currency_code) -%}
    {{ amount|coreshop_format_money(currency_code, coreshop.localeCode) }}
{%- endmacro -%}

{%- macro convertAndFormat(amount) -%}
    {% from _self import format %}

    {{- format(amount|coreshop_convert_currency(coreshop.store.currency.isoCode, coreshop.currency.isoCode), coreshop.currency.isoCode) }}
{%- endmacro -%}

{%- macro convertAndFormatFromCustomCurrency(fromCurrencyIso, amount) -%}
    {% from _self import format %}

    {{- format(amount|coreshop_convert_currency(fromCurrencyIso, coreshop.currency.isoCode), coreshop.currency.isoCode) }}
{%- endmacro -%}

{%- macro getPrice(product, with_tax) -%}
    {% from _self import convertAndFormat %}

    {% if with_tax is null %}
        {% set with_tax = true %}
    {% endif %}

    {{- convertAndFormat(product|coreshop_product_price(coreshop.context, with_tax)) }}
{%- endmacro -%}

{%- macro getRetailPrice(product, with_tax) -%}
    {% from _self import convertAndFormat %}

    {% if with_tax is null %}
        {% set with_tax = true %}
    {% endif %}

    {{- convertAndFormat(product|coreshop_product_retail_price(coreshop.context, with_tax)) }}
{%- endmacro -%}

{%- macro getDiscount(product, with_tax) -%}
    {% from _self import convertAndFormat %}

    {% if with_tax is null %}
        {% set with_tax = true %}
    {% endif %}

    {{- convertAndFormat(product|coreshop_product_discount(coreshop.context, with_tax)) }}
{%- endmacro -%}

{%- macro getDiscountPrice(product, with_tax) -%}
    {% from _self import convertAndFormat %}

    {% if with_tax is null %}
        {% set with_tax = true %}
    {% endif %}

    {{- convertAndFormat(product|coreshop_product_discount_price(coreshop.context, with_tax)) }}
{%- endmacro -%}
